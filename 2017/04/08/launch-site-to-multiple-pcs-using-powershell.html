<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <meta name="description" content="DustinSpears.com : Code snippets and scripts.">

    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=">

    <title>DustinSpears.com</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner1" href="/about">About</a>
          <h1 id="project_title"><a class="title-color" href="/">DustinSpears.com</a></h1>
          <h2 id="project_tagline">Code snippets and scripts.</h2>

          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1 class="post-title" itemprop="name headline">Launch Site to multiple PCs using PowerShell</h1>
<p class="post-meta">
  <time datetime="2017-04-08T10:46:13-04:00" itemprop="datePublished">
    
    Apr 8, 2017
  </time>
</p>
<p>Using a combination of PsExec and PowerShell, I created a script to launch mutiple browsers on different laptops. This was a short project I did for a computer lab teacher in my children’s elementary school. This script uses pop ups for data entry.</p>

<p><em>Warning: The password for an admin account is sent in clear text to acheive this.</em></p>

<p>The script uses 4 main components to achieve this:</p>

<ul>
  <li>PsExec, which can be downloaded <a href="https://technet.microsoft.com/en-us/sysinternals/bb897553.aspx">here</a>.</li>
  <li>PowerShell</li>
  <li>Text file with list of PCs</li>
  <li>An admin account.</li>
</ul>

<p>Lets get to the good stuff…</p>

<p>First off, lets create a pop up greeting the user :)
I called my program Mass Launch.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vg">$wshell</span> <span class="o">=</span> <span class="no">New</span><span class="o">-</span><span class="no">Object</span> <span class="o">-</span><span class="no">ComObject</span> <span class="no">Wscript</span><span class="o">.</span><span class="no">Shell</span>
<span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"Welcome to Mass Launch! `n`nBy: Dustin Spears"</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span></code></pre></figure>

<p>The next part of the script will ask for the path to the list of PCs.  The last parameter for the input obx pre-fills a suggested location. Then, we end with a if statement, requiring a file to be provided.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vg">$path</span> <span class="o">=</span> <span class="no">Get</span><span class="o">-</span><span class="no">Location</span>
<span class="p">[</span><span class="no">System</span><span class="o">.</span><span class="no">Reflection</span><span class="o">.</span><span class="no">Assembly</span><span class="p">]</span><span class="o">::</span><span class="no">LoadWithPartialName</span><span class="p">(</span><span class="s1">'Microsoft.VisualBasic'</span><span class="p">)</span> <span class="o">|</span> <span class="no">Out</span><span class="o">-</span><span class="no">Null</span>
<span class="vg">$file</span> <span class="o">=</span> <span class="p">[</span><span class="no">Microsoft</span><span class="o">.</span><span class="no">VisualBasic</span><span class="o">.</span><span class="no">Interaction</span><span class="p">]</span><span class="o">::</span><span class="no">InputBox</span><span class="p">(</span><span class="s2">"Enter the file with computers:"</span><span class="p">,</span> <span class="s2">"File Name"</span><span class="p">,</span> <span class="s2">"$path</span><span class="se">\p</span><span class="s2">cs.txt"</span><span class="p">)</span>

<span class="no">If</span><span class="p">(</span><span class="o">-</span><span class="no">Not</span> <span class="vg">$file</span><span class="p">){</span>
    <span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"No file was entered."</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span>
    <span class="nb">exit</span>
<span class="p">}</span></code></pre></figure>

<p>Next, we will prompt the user for the website to be sent to the PCs. If the user doesn’t provide a website, the script will end with an error message.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">[</span><span class="no">System</span><span class="o">.</span><span class="no">Reflection</span><span class="o">.</span><span class="no">Assembly</span><span class="p">]</span><span class="o">::</span><span class="no">LoadWithPartialName</span><span class="p">(</span><span class="s1">'Microsoft.VisualBasic'</span><span class="p">)</span> <span class="o">|</span> <span class="no">Out</span><span class="o">-</span><span class="no">Null</span>
<span class="vg">$site</span> <span class="o">=</span> <span class="p">[</span><span class="no">Microsoft</span><span class="o">.</span><span class="no">VisualBasic</span><span class="o">.</span><span class="no">Interaction</span><span class="p">]</span><span class="o">::</span><span class="no">InputBox</span><span class="p">(</span><span class="s2">"Enter the website:"</span><span class="p">,</span> <span class="s2">"Website"</span><span class="p">,</span> <span class="s2">"$site"</span><span class="p">)</span>

<span class="no">If</span><span class="p">(</span><span class="o">-</span><span class="no">Not</span> <span class="vg">$site</span><span class="p">){</span>
    <span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"No site was entered."</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span>
    <span class="nb">exit</span>
<span class="p">}</span></code></pre></figure>

<p>The following part of the script pulls the current domain, and the fills the $pcs array with the computer names. The if statement checks for the pcs to be seperated by 1 space only. The suggested format for the pc text file is as follows:
KCSHDB64Z1 KCSG5ZL4Z1 KCS18F54Z1</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vg">$domain</span> <span class="o">=</span> <span class="p">(</span><span class="no">Get</span><span class="o">-</span><span class="no">WmiObject</span> <span class="no">Win32_ComputerSystem</span><span class="p">)</span><span class="o">.</span><span class="no">Name</span>
<span class="vg">$pcs</span> <span class="o">=</span> <span class="no">Get</span><span class="o">-</span><span class="no">Content</span> <span class="vg">$file</span> <span class="o">-</span><span class="no">Delimiter</span> <span class="s1">' '</span>

<span class="no">If</span> <span class="p">(</span><span class="o">-</span><span class="no">Not</span> <span class="vg">$pcs</span><span class="p">)</span> <span class="p">{</span>
    <span class="no">Write</span><span class="o">-</span><span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"Error! Make sure the computers names in the file are seperated by 1 space only."</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span>
    <span class="nb">exit</span>
<span class="p">}</span></code></pre></figure>

<p>Finally, the list of PCs is iterrated through launching Chrome with the provided site! This part of the script requires the username and password of an administrator account.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Try</span><span class="p">{</span>
    <span class="no">ForEach</span> <span class="p">(</span><span class="vg">$pc</span> <span class="no">In</span> <span class="vg">$pcs</span><span class="p">)</span> <span class="p">{</span>
	<span class="vg">$pcTrimmed</span> <span class="o">=</span> <span class="vg">$pc</span><span class="o">.</span><span class="no">Trim</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"domain"</span>
        <span class="no">Invoke</span><span class="o">-</span><span class="no">Expression</span> <span class="s1">'&amp; psexec \\$pcTrimmed -u domain\username -p password -i -d "C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" "$site"'</span>
    <span class="p">}</span> 
<span class="p">}</span>
<span class="no">Catch</span><span class="p">{</span>
    <span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"Unexpected error has occured."</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span>
    <span class="nb">exit</span>
<span class="p">}</span>

<span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"Thank you for using Mass Launch!."</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span></code></pre></figure>

<p>For those who are just looking for the source code, you may copy from below or download it from my repo. Thanks, and happy scripting!</p>

<p><a href="https://github.com/spearsd/masslaunch/blob/master/masslaunch.ps1">GitHub</a></p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vg">$wshell</span> <span class="o">=</span> <span class="no">New</span><span class="o">-</span><span class="no">Object</span> <span class="o">-</span><span class="no">ComObject</span> <span class="no">Wscript</span><span class="o">.</span><span class="no">Shell</span>
<span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"Welcome to Mass Launch! `n`nBy: Dustin Spears"</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span>

<span class="vg">$path</span> <span class="o">=</span> <span class="no">Get</span><span class="o">-</span><span class="no">Location</span>
<span class="p">[</span><span class="no">System</span><span class="o">.</span><span class="no">Reflection</span><span class="o">.</span><span class="no">Assembly</span><span class="p">]</span><span class="o">::</span><span class="no">LoadWithPartialName</span><span class="p">(</span><span class="s1">'Microsoft.VisualBasic'</span><span class="p">)</span> <span class="o">|</span> <span class="no">Out</span><span class="o">-</span><span class="no">Null</span>
<span class="vg">$file</span> <span class="o">=</span> <span class="p">[</span><span class="no">Microsoft</span><span class="o">.</span><span class="no">VisualBasic</span><span class="o">.</span><span class="no">Interaction</span><span class="p">]</span><span class="o">::</span><span class="no">InputBox</span><span class="p">(</span><span class="s2">"Enter the file with computers:"</span><span class="p">,</span> <span class="s2">"File Name"</span><span class="p">,</span> <span class="s2">"$path</span><span class="se">\p</span><span class="s2">cs.txt"</span><span class="p">)</span>

<span class="no">If</span><span class="p">(</span><span class="o">-</span><span class="no">Not</span> <span class="vg">$file</span><span class="p">){</span>
    <span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"No file was entered."</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span>
    <span class="nb">exit</span>
<span class="p">}</span>

<span class="p">[</span><span class="no">System</span><span class="o">.</span><span class="no">Reflection</span><span class="o">.</span><span class="no">Assembly</span><span class="p">]</span><span class="o">::</span><span class="no">LoadWithPartialName</span><span class="p">(</span><span class="s1">'Microsoft.VisualBasic'</span><span class="p">)</span> <span class="o">|</span> <span class="no">Out</span><span class="o">-</span><span class="no">Null</span>
<span class="vg">$site</span> <span class="o">=</span> <span class="p">[</span><span class="no">Microsoft</span><span class="o">.</span><span class="no">VisualBasic</span><span class="o">.</span><span class="no">Interaction</span><span class="p">]</span><span class="o">::</span><span class="no">InputBox</span><span class="p">(</span><span class="s2">"Enter the website:"</span><span class="p">,</span> <span class="s2">"Website"</span><span class="p">,</span> <span class="s2">"$site"</span><span class="p">)</span>

<span class="no">If</span><span class="p">(</span><span class="o">-</span><span class="no">Not</span> <span class="vg">$site</span><span class="p">){</span>
    <span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"No site was entered."</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span>
    <span class="nb">exit</span>
<span class="p">}</span>

<span class="vg">$domain</span> <span class="o">=</span> <span class="p">(</span><span class="no">Get</span><span class="o">-</span><span class="no">WmiObject</span> <span class="no">Win32_ComputerSystem</span><span class="p">)</span><span class="o">.</span><span class="no">Name</span>
<span class="vg">$pcs</span> <span class="o">=</span> <span class="no">Get</span><span class="o">-</span><span class="no">Content</span> <span class="vg">$file</span> <span class="o">-</span><span class="no">Delimiter</span> <span class="s1">' '</span>

<span class="no">If</span> <span class="p">(</span><span class="o">-</span><span class="no">Not</span> <span class="vg">$pcs</span><span class="p">)</span> <span class="p">{</span>
    <span class="no">Write</span><span class="o">-</span><span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"Error! Make sure the computers names in the file are seperated by 1 space only."</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span>
    <span class="nb">exit</span>
<span class="p">}</span>

<span class="no">Try</span><span class="p">{</span>
    <span class="no">ForEach</span> <span class="p">(</span><span class="vg">$pc</span> <span class="no">In</span> <span class="vg">$pcs</span><span class="p">)</span> <span class="p">{</span>
	<span class="vg">$pcTrimmed</span> <span class="o">=</span> <span class="vg">$pc</span><span class="o">.</span><span class="no">Trim</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"domain"</span>
        <span class="no">Invoke</span><span class="o">-</span><span class="no">Expression</span> <span class="s1">'&amp; psexec \\$pcTrimmed -u domain\username -p password -i -d "C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" "$site"'</span>
    <span class="p">}</span> 
<span class="p">}</span>
<span class="no">Catch</span><span class="p">{</span>
    <span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"Unexpected error has occured."</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span>
    <span class="nb">exit</span>
<span class="p">}</span>

<span class="vg">$wshell</span><span class="o">.</span><span class="no">Popup</span><span class="p">(</span><span class="s2">"Thank you for using Mass Launch!."</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"Mass Launch"</span><span class="p">)</span></code></pre></figure>



        
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <!--  -->
        <p class="copyright">© 2017 DustinSpears.com</p>
      </footer>
    </div>

    
  </body>
</html>
